(function(d,c){"function"===typeof define&&define.amd?define(c):"undefined"!==typeof require&&"object"===typeof exports?c.exports=c:d.Pipeline=c})(this,function(){function d(a){var b;if("string"!==typeof a)throw new TypeError;if("undefined"===typeof(b=f[a])||null===b)b=f[a]=function(a){function b(){var a=d;d=[];return a}function m(){var a=0,h=b(),c=g.length,d;if(0<h.length)for(;a<c;++a)"function"===typeof(d=g[a])&&setTimeout(d.apply(d,h),0);return h}function n(){clearInterval(k)}function c(){n();
k=setTimeout(function(){k=setInterval(m,l)},l)}var g=[],d=[],e=[],l=60,k;c();return{_topic:a,unregisterSubscriber:function(a){for(var b=-1,d=e.length;e[++b]!==a&&b<d;);return b<d?e.slice(b,1)[0]:null},registerSubscriber:function(a){e.push(a);return a},addCallback:function(a,b){var d=-1;if("undefined"===typeof b||null===b)throw new SyntaxError;if("function"!==typeof b.push)throw new TypeError;for(;g[++d];);b.push((g[d]=a).uid=d+1);return b},removeCallbacks:function(a){var b;if("undefined"===typeof a||
null===a)throw new SyntaxError;if("function"!==typeof a.pop)throw new TypeError;for(;b=a.pop();)g[b-1]=void 0},archiveMessage:function(a){d.push(a)},takeMessages:b,distribute:m,startBroadcast:c,stopBroadcast:n,setBroadcastDelay:function(a){l=a}}}(a);return b}function c(a,b,c){var f;if("function"!==typeof b)throw new SyntaxError;return(f=d(a)).addCallback(b,function(a){var b=f,d=[],c=r.bind(d),q=s.bind(d),c={getModerator:function(){return b},addCallback:function(a){console.log(b);b.addCallback(a,this)},
push:c,pop:q,destroy:function(){var a;b.removeCallbacks(this);b=d=void 0;for(a in this)delete this[a]}},e;if("undefined"===typeof a||null===a)a=c;else for(e in c)a[e]=c[e];return b.registerSubscriber(a)}(c))}function p(a){var b;if("undefined"===typeof a||null===a)throw new TypeError;if("undefined"===typeof(b=a.getModerator())||null===b)throw new SyntaxError;(a=b.unregisterSubscriber(a))&&a.destroy();return!!a}var f={},r=Array.prototype.push,s=Array.prototype.pop;return{publish:function(a,b){d(a).archiveMessage(b)},
trigger:function(a,b,c){a=d(a).distributeMessages();b||a.push(b);if("undefined"!==typeof c){if("function"!==typeof c)throw new TypeError;setTimeout(c.apply(c,a),0)}},extend:function(a,b){var c;return(c=a.getModerator())?c.addCallback(b,a):null},subscribe:c,on:c,unsubscribe:p,off:p}}());
